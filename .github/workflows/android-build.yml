name: Android CI

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    name: Build and Release APK
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup JDK
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: 17
          
      - name: Set execution flag for gradlew
        run: chmod +x gradlew
        
      - name: Build APK
        run: ./gradlew assembleDebug --stacktrace
        
      - name: Upload APK to Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: app-debug
          path: app/build/outputs/apk/debug/app-debug.apk
          
      - name: Create Release and Upload APK
        uses: softprops/action-gh-release@v2
        with:
          tag_name: v1.0.${{ github.run_number }}
          name: Release v1.0.${{ github.run_number }}
          files: app/build/outputs/apk/debug/app-debug.apk
          body: |
            ## í™˜ê¸° ìŠ¤ìºë„ˆ v1.0.${{ github.run_number }}
            
            ### ğŸ“± ì„¤ì¹˜ ë°©ë²•
            1. **app-debug.apk** ë‹¤ìš´ë¡œë“œ
            2. íœ´ëŒ€í°ì—ì„œ "ì•Œ ìˆ˜ ì—†ëŠ” ì¶œì²˜" ì•± ì„¤ì¹˜ í—ˆìš©
            3. APK íŒŒì¼ ì‹¤í–‰
            
            ### âœ¨ ì£¼ìš” ê¸°ëŠ¥
            - ğŸ“· ARCore 3D ìŠ¤ìº”
            - ğŸŒ¬ï¸ CFD í™˜ê¸° ì‹œë®¬ë ˆì´ì…˜
            - ğŸ“Š 3D ì‹œê°í™”
            - ğŸ’¾ ë¡œì»¬ ë°ì´í„° ì €ì¥
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
