# 공기흐름 시각화 v1.1 - 릴리스 노트

## 📱 다운로드 링크

**최신 버전:** v1.1 (2026-02-13)

### 🔗 다운로드 (핸드폰에서 클릭)
```
https://files.catbox.moe/5pnssk.apk
```

### 📷 QR 코드
바탕화면 파일: `apk_qr_code_v1.1.png`

---

## 🐛 수정된 버그 (v1.0 → v1.1)

### CRITICAL 버그 수정

#### 1. ✅ 시각화 모드 전환 불가 문제 해결
- **문제**: Chip 버튼(풍속/정체영역/바이러스농도) 클릭 시 작동하지 않음
- **원인**: `setRenderMode()` 함수가 잘못된 HTML 파일(cfd-simulator.html)에서 호출
- **수정**: three-viewer.html 전용으로 시각화 모드 로직 재구현
- **영향**: 이제 3가지 시각화 모드 모두 정상 작동

#### 2. ✅ 앱 크래시 방지 (생명주기 문제)
- **문제**: Fragment 종료 후 WebView 호출 시 크래시
- **원인**: 비동기 시뮬레이션 중 사용자가 화면 전환
- **수정**: 
  - `isAdded`/`isDetached` 체크 추가
  - `webView.post()` wrapper로 메인 스레드 보장
- **영향**: 화면 전환 중 크래시 방지

#### 3. ✅ Android 14+ 호환성 확보
- **문제**: `getSerializable()` deprecated API 사용
- **원인**: Android 13부터 경고, Android 14부터 작동 불가
- **수정**: 
  - `VentilationOpening`에 `Parcelable` 인터페이스 추가
  - `@Parcelize` 어노테이션으로 자동 구현
  - Android 버전별 분기 처리
- **영향**: 최신 Android에서 장치 설정 가능

#### 4. ✅ 개선율 계산 오류 수정
- **문제**: 환기 점수가 0점일 때 division by zero 에러
- **원인**: `improvement = (after - before) / before` 계산
- **수정**: Zero 체크 추가, 0점→100% 개선으로 처리
- **영향**: 솔루션 탭에서 크래시 방지

#### 5. ✅ 필드명 불일치 수정
- **문제**: `virusConcentrationField`, `avgVirusConcentration` 미정의
- **원인**: `SimulationResults`의 실제 필드명과 불일치
- **수정**: `concentration`, `avgConcentration`으로 변경
- **영향**: 바이러스 농도 시각화 정상 작동

---

## 🔍 코드 품질 감사 결과

### 검증 항목
- ✅ 컴파일 에러: 없음
- ✅ WebView 브리지: 정상
- ✅ JavaScript 함수 매칭: 9/9 일치
- ✅ Fragment 생명주기: 안전
- ✅ Null 안전성: 향상

### 개선 사항
- WebView JavaScript 실행 타이밍 안전화
- Fragment 생명주기 체크 추가
- Android 14+ 호환성 확보
- Division by zero 방지
- 필드명 일관성 확보

---

## 📊 변경 파일 (5개)

| 파일 | 변경 내용 |
|------|----------|
| `VisualizationTabFragment.kt` | 시각화 모드 로직 재구현 (+30줄) |
| `ScanData.kt` | Parcelable 인터페이스 추가 |
| `DeviceConfigBottomSheet.kt` | Android 14+ 호환 코드 추가 |
| `SolutionTabFragment.kt` | Zero division 방지 |
| `build.gradle.kts` | kotlin-parcelize 플러그인 추가 |

---

## 🚀 설치 방법

### 1. 다운로드
- **QR 코드 스캔**: `apk_qr_code_v1.1.png` 핸드폰 카메라로 스캔
- **직접 링크**: https://files.catbox.moe/5pnssk.apk

### 2. 설치 허용
- 설정 → 보안 → 알 수 없는 출처 허용 (Chrome)

### 3. 설치
- 다운로드 완료 → "열기" 클릭
- Chrome 경고 무시 → "계속" 클릭

### 4. 확인
- 앱 이름: **공기흐름 시각화**
- 버전: **1.1**

---

## 📝 v1.0 → v1.1 업그레이드 가이드

### 기존 v1.0 사용자
1. 기존 앱 삭제 (데이터 백업 불필요)
2. v1.1 APK 다운로드 및 설치
3. 정상 작동 확인

### 데이터 보존
- Room 데이터베이스: 삭제 후 재설치 시 초기화됨
- 스캔 데이터: 손실됨 (백업 기능 없음)

---

## 🔧 개발 정보

### 빌드 정보
- **빌드 시각**: 2026-02-13 13:58 KST
- **Gradle**: assembleDebug
- **컴파일 SDK**: 34
- **Min SDK**: 26
- **Target SDK**: 34
- **APK 크기**: 7.1 MB

### Git Commit
```
Commit: 2245655
Message: Fix critical bugs discovered in code audit
Files: 5 changed, 61 insertions(+), 27 deletions(-)
```

---

## ⚠️ 알려진 제한사항

### 현재 버전의 제한
1. ARCore 미지원 기기에서 3D 스캔 불가 (간단 모델 생성은 가능)
2. CFD 시뮬레이션 타임아웃 없음 (30초 이상 걸릴 수 있음)
3. 데이터 백업/복원 기능 없음
4. 클라우드 동기화 미지원

### 추후 개선 예정
- [ ] CFD 시뮬레이션 진행률 표시
- [ ] 데이터 백업/복원 기능
- [ ] APK 최적화 (크기 감소)
- [ ] 오프라인 도움말 추가

---

## 📞 문제 발생 시

### 일반적인 문제

**Q: "알 수 없는 출처" 설치가 안 됨**
- A: 설정 → 보안 → Chrome 알 수 없는 출처 허용

**Q: 시뮬레이션이 멈춤**
- A: 격자 해상도가 너무 높거나 장치가 너무 많음 → 장치 수 줄이기

**Q: 3D 시각화가 안 보임**
- A: 시뮬레이션 실행 버튼 클릭 → 완료 대기

**Q: Chip 버튼이 작동 안 함**
- A: v1.1에서 수정됨 → 업그레이드 필요

---

## ✅ 체크리스트

### 설치 전
- [ ] Android 8.0 (API 26) 이상 확인
- [ ] 저장공간 50MB 이상 확보
- [ ] 알 수 없는 출처 허용 설정

### 설치 후 테스트
- [ ] 앱 실행 확인
- [ ] 스캔 탭 → 간단 모델 생성
- [ ] 설정 탭 → 장치 추가/삭제
- [ ] 결과 탭 → 시뮬레이션 실행
- [ ] 3개 Chip 버튼 전환 (풍속/정체영역/바이러스농도)
- [ ] 진단 점수 확인
- [ ] 솔루션 추천 확인

---

## 📦 이전 버전

| 버전 | 릴리스 날짜 | 다운로드 |
|------|------------|----------|
| v1.0 | 2026-02-13 | https://files.catbox.moe/vqk92y.apk |
| v1.1 | 2026-02-13 | https://files.catbox.moe/5pnssk.apk (현재) |

---

**최종 업데이트**: 2026-02-13 13:58 KST
